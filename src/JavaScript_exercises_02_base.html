<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JavaScript課題2</title>
    <link href="../lib/bootstrap-4.1.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/bootstrap-4.1.2/js/bootstrap.min.js"></script>
    <script>
    var checkRequired = function( val, errorMsg ){
        if ( ! val ){
          errorMsg.push('入力されていません');
        }
      }
      var checkLength = function( val, errorMsg, length ){
        if ( val && val.length > length ){
          errorMsg.push( length + '文字を超えています' );
        }
      }
      var checkAlphabet = function( val, errorMsg ){
       if ( val && ! /^[a-zA-Z]*$/.test( val ) ){
         errorMsg.push( '英文字で入力してください' );
       }
      }
      var checkNumeric = function( val, errorMsg ){
       if ( val && ! /^[0-9]*$/.test( val ) ){
         errorMsg.push( '数字で入力してください' );
       }
      }
      var checkNumericRange = function( val, errorMsg, min, max ){
       if ( val && /^[0-9]*$/.test( val ) && ( Number(val) < min || max < Number(val) ) ){
         errorMsg.push( min + '以上' + max + '以下の範囲で入力してください' );
       }
      }
      var inputCheckWrapper = function(){
        var errorMsg = [];
        var MSG_SEPARATOR = ' , ';
        var sendNgFlg = false;

        var args = Array.prototype.slice.call(arguments, 0);
        /*
        $.each( args, function( idx, val ){
          if ( typeof( val ) === 'function' ) {
            val();
          }
        }

        if ( errorMsg.length ){
          //elem.after('<span class="errorMsg">' + errorMsg.join( MSG_SEPARATOR ) + '</span>');
          sendNgFlg = true;
        }
        */

        return sendNgFlg;
      }

      $( function(){
        $('#send').on( 'click', function(){
          $('.errorMsg').remove();
          var MSG_SEPARATOR = ' , ';
          var sendNgFlg = false;

          var errorMsg = [];

          //inputCheckWrapper();

          var elem = $('#named');
          checkRequired( elem.val(), errorMsg );
          checkLength( elem.val(), errorMsg, 15 );
          checkAlphabet( elem.val(), errorMsg );
          if ( errorMsg.length ){
            elem.after('<span class="errorMsg">' + errorMsg.join( MSG_SEPARATOR ) + '</span>');
            sendNgFlg = true;
          }

          errorMsg = [];
          elem = $('#age');
          checkNumeric( elem.val(), errorMsg );
          checkNumericRange( elem.val(), errorMsg, 0, 120 );
          if ( errorMsg.length ){
            elem.after('<span class="errorMsg">' + errorMsg.join( MSG_SEPARATOR ) + '</span>');
            sendNgFlg = true;
          }

          errorMsg = [];
          var elem = $('input[name=sex]:checked');
          checkRequired( elem.val(), errorMsg );
          if ( errorMsg.length ){
            $('input[name=sex]').parent().parent().append('<span class="errorMsg">' + errorMsg.join( MSG_SEPARATOR ) + '</span>');
            sendNgFlg = true;
          }
          if ( sendNgFlg ){
            return false;
          }
          $('form').submit();
        });
        $('#reset').on( 'click', function(){
          $('#named, #age').val( '' );
          $('input[type=radio][name=sex][value=man], input[name=dmSend]').prop( 'checked', true );
          $('.errorMsg').remove();
        });
      });
    </script>
    <style type="text/css">
      .errorMsg {
        padding-left: 10px;
        font-size: 12px;
        color: red;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">JavaScript課題2</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">会員登録</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">会員検索</a>
          </li>
        </ul>
        <span class="navbar-text">
          test-user さんでログイン中
        </span>
      </div>
    </nav>
    <div class="jumbotron">
      <p>以下の問題に沿ってJavaScript (JQuery) で実装しなさい。</p>
      <pre>
      ■問題
      ・リセットボタン押下で、各入力項目を初期化する
      ・送信ボタン押下で、各入力項目で以下の入力チェックを行う
        ・名前は15文字以内、英文字のみ。必須
        ・年齢は0～120以内。数字のみ。任意
        ・性別は必須
        ・DM送信希望は任意
      ・エラーメッセージは、各入力項目の右側に表示する
      </pre>
    </div>
    <div>
      <form method="post" action="JavaScript_exercises_02_transition.html">
        <div class="form-group">
          <label>名前</label>
          <input type="text" id="named" size="20" maxlength="20" placeholder="Yamada Tarou" class="form-control">
        </div>
        <div class="form-group">
          <label>年齢</label>
          <input type="text" id="age" size="3" maxlength="3" placeholder="20" class="form-control">
        </div>
        <br />
        <div class="form-group">
          <label><input type="radio" name="sex" value="man" checked="checked" />男性</label>
          <label><input type="radio" name="sex" value="woman" />女性</label>
          <label><input type="radio" name="sex" value="otherwise" />その他</label>
        </div>
        <div class="checkbox">
          <label><input type="checkbox" name="dmSend" checked="checked" />DM送信希望</label>
        </div>
        <br />
        <button type="button" id="send">送信</button>
        <button type="button" id="reset">リセット</button>
      </form>
    </div>
  </body>
</html>
